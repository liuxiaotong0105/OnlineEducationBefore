define("widget/treasureChest",function(e){function t(e){$.extend(this,new p);this.state="READY",this.data=$.extend({},e),this.type=this.data.type,this.name=this.data.name,this.delay=this.data.delay}function i(e,t){function i(e){var t={png:"https://a.msstatic.com/huya/main/widget/treasureChest/img/box_9222f0f.png",gif:"https://a.msstatic.com/huya/main/widget/treasureChest/img/box_0da78ad.gif"};return{1:t,2:{png:"https://a.msstatic.com/huya/main/widget/treasureChest/img/box2_3aa7c62.png",gif:"https://a.msstatic.com/huya/main/widget/treasureChest/img/box2_c10bf9a.gif"},3:{png:"https://a.msstatic.com/huya/main/widget/treasureChest/img/box3_540f478.png",gif:"https://a.msstatic.com/huya/main/widget/treasureChest/img/box3_81351e5.gif"},4:{png:"https://a.msstatic.com/huya/main/widget/treasureChest/img/box4_d52abd7.png",gif:"https://a.msstatic.com/huya/main/widget/treasureChest/img/box4_0fa0332.gif"}}[e]||t}function a(a){var s=o.find(".btn");if(!HUYA_UTIL.getCookieVal("yyuid"))return void s.addClass("usable").text("\u767b\u5f55\u9886\u53d6").on("click",function(e){e.preventDefault(),TT.login.login()});if("CD"===a&&e.on("cd",function(e){var t=Math.floor(e/60),i=e%60;s.text((10>t?"0":"")+t+":"+(10>i?"0":"")+i)}),"ING"===a&&(o.find("img")[0].src=i(e.type).gif,s.addClass("usable").text("\u9886\u53d6"),s.on("click",function(t){t.preventDefault(),e.draw();try{ya.reportProductEvent({eid:"click/zhibo/treasure/lq/"+e.type,eid_desc:"\u70b9\u51fb/\u76f4\u64ad\u95f4/\u85cf\u5b9d\u7bb1/\u9886\u53d6/"+e.name})}catch(t){}})),"ED"===a){s.removeClass("usable").addClass("disable").text("\u5df2\u9886\u53d6");var n=t.size-1;o.find(".num").text(n)[n>0?"show":"hide"]()}}function s(){var i="ED"===e.state?t.size-1:t.size;o.find(".num").text(i)[i>1?"show":"hide"]()}function n(){e.off("stateChange",a),t.off("change",s),o.remove()}var o=$('<div class="liveRoom_treasureChest"><span class="box"><img src="'+i(e.type).png+'" alt="\u5b9d\u7bb1" /></span><i class="num"></i><p class="btn-wrap"><span class="btn">loading</span></p><div class="waitTips"><p class="tit"><span class="nick">'+r(e.data.senderNick)+'</span><span class="aName">\u7684'+e.name+'</span></p><div class="cont"><p>\u9886\u53d6\u8fd8\u672a\u5f00\u59cb\uff0c\u8bf7\u8010\u5fc3\u7b49\u5f85~</p><p>\u591a\u53d1\u5f39\u5e55\u53ef\u63d0\u9ad8\u4e2d\u5956\u6982\u7387\u54e6\uff01</p></div><i class="arrow"></i></div></div>');o.on("mouseenter",function(){"CD"===e.state&&o.find(".waitTips").show()}).on("mouseleave",function(){o.find(".waitTips").hide()}),s(),e.on("stateChange",a),t.on("change",s),$("#J_treasureChestContainer").append(o),$.extend(this,{loading:function(){o.find("img")[0].src=i(e.type).png,o.find(".btn").removeClass("usable disable").text("loading")},fadeOut:function(){o.hide(500)},destroy:n})}function a(e){function a(e){c&&c.destroy(),o=new t(e),c=new i(o,r),o.on("stateChange",function(e){if("END"===e)if(r.dequeue(),r.size>0)c.loading();else{var t=c;t.fadeOut(),setTimeout(function(){t.destroy()},600),c=null}}),o.start()}function s(e){switch(TT.log("\u524d\u7aef: treasureUpdateNotice.iState:"+e.iState),e.iState){case 1:a({delay:e.iCountDown,senderNick:e.sSendNick,type:e.iTreasureType,name:e.sTreasureName});break;case 2:o&&o.end();break;case 3:var t=e.iQueneSize-r.size;t&&t>0&&r.enqueue(new Array(t))}}try{console.log("\u524d\u7aef: queryTreasureInfoRsp.iQueneSize:"+e.iQueneSize)}catch(n){}var r=new h,o=null,c=null;e.iQueneSize>0&&(r.enqueue(new Array(e.iQueneSize)),a({state:["","CD","ING","ED"][e.iStatus],delay:e.iCountDown,senderNick:e.sNickName,type:e.iTreasureType,name:e.sTreasureName})),d.isH5?d.ready(function(e){e.addTafListener("6604",s)}):d.on("treasureUpdateNotice",function(e){s(e.param)})}function s(t){return t.iPrizeType<=0?void e.async("widget/dialog",function(e){var t=e.layer({container:"#watchChat_pub",view:['<div class="treasureChest-tips">','<div class="tct-wrap">','<p class="tct-cont">\u624b\u6c14\u4e0d\u4f73\uff0c\u4f60\u6ca1\u6709\u9886\u53d6\u5230\u5956\u52b1~</p>',"</div>",0/0].join(""),lock:!1});setTimeout(function(){t.close()},3e3)}):void(6==t.iPrizeType||9==t.iPrizeType||14==t.iPrizeType?e.async("widget/dialog",function(e){var i=e.layer({container:"#watchChat_pub",view:['<div class="treasureChest-tips">','<div class="tct-wrap">','<i class="tct-icon"></i>','<div class="tct-cont">','<p>\u606d\u559c\u4f60\u83b7\u5f97<em class="tct-prize">'+t.sPrizeName+"</em>\uff01</p>",'<p class="tct-ps">\u5956\u52b1\u5df2\u5b58\u5165'+(14==t.iPrizeType?'<a target="_blank" href="'+TT.app.i+'index.php?m=MyGift&do=listMyGift">\u6211\u7684\u798f\u5229</a>':"\u5305\u88f9")+"\u4e2d\uff0c\u5feb\u53bb\u67e5\u770b\u5427~</p>","</div>","</div>",'<a class="tct-x" href="#"></a>',0/0].join(""),lock:!1});i.view.find(".tct-x").on("click",function(e){e.preventDefault(),i.close()})}):e.async("widget/dialog",function(e){var i=e.layer({container:"#watchChat_pub",view:['<div class="treasureChest-tips">','<div class="tct-wrap">','<i class="tct-icon"></i>','<p class="tct-cont">\u606d\u559c\u4f60\u83b7\u5f97<em class="tct-prize">'+t.sPrizeName+"</em>\uff01</p>","</div>",0/0].join(""),lock:!1});setTimeout(function(){i.close()},3e3)}))}function n(t){var i=['<div class="treasureChest-winningRecord">','<span class="treasureChest-winningRecord-user">'+r(t.sUserNick)+"</span>"," \u83b7\u5f97 ",'<span class="treasureChest-winningRecord-sender">'+r(t.sStarterNick)+"</span>"," \u6d3e\u9001\u7684 ",'<span class="treasureChest-winningRecord-prize">'+t.sPrizeName+"</span>","</div>"].join("");e.async("msgManager",function(e){e.add(i)})}function r(e){return"string"!=typeof e?e:e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\'/g,"&#39;").replace(/\"/g,"&quot;")}var o=e("TTA"),c=e("TTR"),d=e("TTP"),l=e("tools"),p=e("Event"),u='.treasureChestContainer{position:absolute;right:10px;bottom:110px;z-index:99}.liveRoom_treasureChest{position:relative;width:90px;height:90px}.liveRoom_treasureChest .box{width:90px;height:90px}.liveRoom_treasureChest .num{position:absolute;top:0;right:0;padding:0 6px;background:#FF1313;color:#fff;border-radius:50%}.liveRoom_treasureChest .btn-wrap{position:absolute;left:0;bottom:0;width:100%;text-align:center}.liveRoom_treasureChest .btn{display:inline-block;padding:2px 9px 3px;background:#F80;color:#fff;text-align:center;border-radius:11px}.liveRoom_treasureChest .btn.usable{cursor:pointer}.liveRoom_treasureChest .btn.disable{background:#9F9F9F}.liveRoom_treasureChest .waitTips{display:none;position:absolute;right:10px;bottom:75px;padding:8px 10px;opacity:.85;font-family:"Microsoft YaHei";border:1px solid #DEDEDE;border-radius:5px;background:#fff;box-shadow:1px 1px 5px 0 rgba(99,99,99,.3);color:#666;white-space:nowrap;word-wrap:normal}.liveRoom_treasureChest .waitTips .tit{font-size:14px;line-height:2;vertical-align:middle}.liveRoom_treasureChest .waitTips .tit .nick{display:inline-block;vertical-align:middle;max-width:8em;overflow:hidden;text-overflow:ellipsis;color:#f80}.liveRoom_treasureChest .waitTips .tit .aName{display:inline-block;vertical-align:middle}.liveRoom_treasureChest .waitTips .cont{line-height:1.8}.liveRoom_treasureChest .waitTips .arrow{position:absolute;bottom:-14px;right:30px;width:0;height:0;overflow:hidden;border:7px solid transparent;border-top-color:#fff}.ie8 .liveRoom_treasureChest .waitTips{max-width:182px}.treasureChest-tips{padding:8px 10px;opacity:.85;font-family:"Microsoft YaHei";border:1px solid #DEDEDE;border-radius:5px;background:#fff;box-shadow:1px 1px 5px 0 rgba(99,99,99,.3);position:absolute;width:85%;z-index:200;color:#666}.treasureChest-tips .tct-wrap{display:table;table-layout:fixed;width:100%;text-align:center;vertical-align:middle;white-space:nowrap;word-wrap:normal}.treasureChest-tips .tct-wrap .tct-icon{display:inline-block;vertical-align:middle;width:54px;height:48px;overflow:hidden;background:url(https://a.msstatic.com/huya/main/widget/treasureChest/img/gift_076deb2.png)}.treasureChest-tips .tct-wrap .tct-cont{display:inline-block;vertical-align:middle;text-align:left;padding-left:.6em;font-size:14px}.treasureChest-tips .tct-wrap .tct-ps{font-size:12px;color:#999}.treasureChest-tips .tct-wrap .tct-ps a{color:#3799ED;text-decoration:underline}.treasureChest-tips .tct-wrap .tct-prize{color:#f80}.treasureChest-tips .tct-x{position:absolute;top:8px;right:8px;width:10px;height:10px;overflow:hidden;background:url(https://a.msstatic.com/huya/main/widget/treasureChest/img/x_0a5b991.png)}.treasureChest-winningRecord{padding:4px 9px;color:#666;vertical-align:middle}.treasureChest-winningRecord-user,.treasureChest-winningRecord-sender,.treasureChest-winningRecord-prize{color:#f80}.treasureChest-winningRecord-user,.treasureChest-winningRecord-sender{display:inline-block;vertical-align:bottom;max-width:8em;overflow:hidden;white-space:nowrap;word-wrap:normal;text-overflow:ellipsis}';l.importStyle(u,"J_treasureBoxStyle"),t.prototype={delay:180,duration:15,start:function(){var e=this;if("READY"===e.state)switch(e.state="START",e.emit("stateChange",e.state),e.data.state){case"CD":e.countdown(e.delay);break;case"ING":e.open(e.duration);break;case"ED":e.ed();break;default:e.countdown(e.delay)}},countdown:function(e){var t=this;t.state="CD",t.emit("stateChange",t.state);var i=e,a=e;t.emit("cd",i,a),t.cdInterval=setInterval(function(){i--,t.emit("cd",i,a),0>=i&&(clearInterval(t.cdInterval),t.open(t.duration))},1e3)},open:function(){var e=this;e.state="ING",e.emit("stateChange",e.state)},end:function(){var e=this;clearInterval(e.cdInterval),e.state="END",e.emit("stateChange",e.state)},ed:function(){var e=this;e.state="ED",e.emit("stateChange",e.state)},draw:function(){if("ING"===this.state){var e=this;TT.sudo(function(){d.ready(function(e){d.isH5?TT.getUserInfo(function(t){var i=new HUYA.TreasureLotteryDrawReq;$.extend(i,{tId:e.userId,sStarterNick:t.userNick,lSid:c.id,lSubSid:c.sid,lPid:o.lp,lRoomId:c.profileRoom,iFromType:5}),e.sendWup2("liveui","sendTreasureLotteryDraw",i,s)}):(d.one("treasureLotteryDrawRsp",function(e){s(e.param)}),e.callAs("treasureLotteryDrawReq"))}),e.ed()})}}};var h=function(){$.extend(this,new p),this.list=[],this.size=0};h.prototype.enqueue=function(e){this.list=this.list.concat(e),this.size=this.list.length,this.emit("change",1)},h.prototype.dequeue=function(){if(!(this.size<=0)){{this.list.shift()}this.size=this.list.length,this.emit("change",0)}};var f=l.once(a);d.isH5?d.ready(function(e){var t=new HUYA.QueryTreasureInfoReq;$.extend(t,{tId:e.userId,lSid:c.id,lSubSid:c.sid,lPid:o.lp,lRoomId:c.profileRoom,iFromType:5}),e.sendWup2("liveui","queryTreasure",t,f)}):(d.one("queryTreasureInfoRsp",function(e){f(e.param)},!0),d.ready(function(){d.call("queryTreasureInfoReq")})),d.isH5?d.ready(function(e){e.addTafListener("6605",n)}):d.on("treasureLotteryResultNotice",function(e){n(e.param)})});