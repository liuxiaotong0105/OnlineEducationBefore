define("week_rank",function(require,exports,module){var TTP=require("TTP"),anchor=require("TTA"),tab=require("rankTab"),tools=require("tools"),roomBeta=require("roomBeta");require("jScrollPane");var debounce=tools.debounce;roomBeta.lazyLoad(function(){require.async("widget/ucard")});var Rank=function(data){function render(e){rankList.html(tpl({data:e})),scrollbar?e&&e.length!=size&&(size=e.length,scrollbarReinit()):(scrollbar=box.jScrollPane({mouseWheelSpeed:20,verticalGutter:0,isOutsideNotPrevent:!1}).data("jsp"),scrollbarReinit=tools.debounce(function(){scrollbar.reinitialise()},100))}function bind(){var e=null,n=box.closest(".week-rank__unit"),t=n.height();rankList.on("mouseenter",function(){var a=box.height();a>t&&(e&&clearTimeout(e),e=setTimeout(function(){n.stop().animate({height:a})},300))}).on("mouseleave",function(){e&&clearTimeout(e),n.stop().animate({height:t})}),TTP.ready(function(){var e;rankList.on("mouseenter",".J_name",e=debounce(function(n){var t=null,a=null,i=$(window).scrollLeft()+Math.min(n.clientX+15,$(window).width()-260),l=$(window).scrollTop()+Math.min(n.clientY+10,$(window).height()-340),o=$(this).closest("li"),r=list[o.index()];r&&require.async("widget/ucard",function(n){n({uid:r.lUid,muteText:"\u5468\u8d21\u699c",init:function(n){a=n,n.view.css({left:i,top:l,zIndex:10,position:"absolute"}),n.view.find(".ucard-x").hide(),n.view.on("mouseenter",function(){clearTimeout(t),e.cancel()}).on("mouseleave",function(){n.destroy()}),n.view.appendTo("body");try{ya.reportProductEvent({eid:"click/zhibo/kp/zgb",eid_desc:"\u70b9\u51fb/\u76f4\u64ad/\u7528\u6237\u5361\u7247/\u5468\u8d21\u699c"})}catch(o){}}})}),$(this).on("mouseleave",function(){t=setTimeout(function(){a&&a.destroy()},200)})},800)).on("mouseleave",function(){e&&e.cancel()})})}function update(e){list=e,render(e),changeCallbacks.fire(e)}var list=data&&data.length?data:[],size=list.length,changeCallbacks=$.Callbacks(),tpl=function(obj){function formatNumber(e,n){for(var t=e?e.toString().split("."):["0"],a=n?n.split("."):[""],i="",l=t[0],o=a[0],r=l.length-1,s=!1,u=o.length-1;u>=0;u--)switch(o.substr(u,1)){case"#":r>=0&&(i=l.substr(r--,1)+i);break;case"0":i=r>=0?l.substr(r--,1)+i:"0"+i;break;case",":s=!0,i=","+i}if(r>=0)if(s)for(var c=l.length;r>=0;r--)i=l.substr(r,1)+i,r>0&&(c-r)%3==0&&(i=","+i);else i=l.substr(0,r+1)+i;i+=".",l=t.length>1?t[1]:"",o=a.length>1?a[1]:"",r=0;for(var u=0;u<o.length;u++)switch(o.substr(u,1)){case"#":r<l.length&&(i+=l.substr(r++,1));break;case"0":i+=r<l.length?l.substr(r++,1):"0"}return i.replace(/^,+/,"").replace(/\.$/,"")}{var __t,__p="";Array.prototype.join}with(obj||{}){if(__p+="",data&&data.length){for(var len=data.length,isUnion=!!HUYA_UTIL.getCookieVal("promoter"),i=0;len>i;i++){var tip="";0==i?tip="num-one":1==i?tip="num-two":2==i&&(tip="num-three");var item=data[i],iNobleLevel=item.iNobleLevel,sNickName=_.escape(item.sNickName),iLevel=item.iUserLevel,beanNum=formatNumber(item.lScore||item.iScore,"#,###");__p+='\n        <li><span class="item-num '+(null==(__t=tip)?"":__t)+'">'+(null==(__t=i+1)?"":__t)+"</span>\n\n            ",iNobleLevel>0&&(__p+='\n                <span class="noble-icon noble-level-'+(null==(__t=iNobleLevel)?"":__t)+'"></span>\n            '),__p+='\n\n            <span class="week-rank-name J_name">'+(null==(__t=sNickName)?"":__t)+'</span>\n\n           \n            <span class="level-icon level-icon'+(null==(__t=iLevel)?"":__t)+'"></span>\n            \n\n            <span class="'+(null==(__t=isUnion?"vb-num":"gold-num")?"":__t)+'">'+(null==(__t=beanNum)?"":__t)+"<i></i></span>\n\n        </li>\n"}__p+="\n\n    ",data.length>3&&(__p+='\n        <li class="showMore">\u6309\u6700\u8fd17\u5929\u89c2\u4f17\u9001\u793c\u6392\u884c</li>\n    '),__p+="\n"}else __p+='\n    <div class="no-rank-tip">\u9001\u4e3b\u64ad\u793c\u7269\uff0c\u4e0a\u8d21\u732e\u699c</div>\n';__p+="\n\n"}return __p},rankList=$("#J_weekRankList"),box=$("#J_weekRankBox"),scrollbar=null,scrollbarReinit=null;return render(list),bind(),{update:update,change:function(e){changeCallbacks.add(e)}}},visible=0===tab.getIndex();tab.change(function(e){visible=0===e});var rank=null,update=function(){function e(e){rank?rank.update(e):rank=new Rank(e)}var n=null;return tab.change(function(){visible&&n&&(e(n),n=null)}),tools.throttle(function(t){visible?e(t):n=t},500)}();TTP.isH5?TTP.ready(function(e){e.addTafListener("6220",function(e){update(e.vWeekRankItem.value)})}):TTP.on("weekRankListRefresh",function(e){e.param.data.lPid&&e.param.data.lPid!=anchor.lp||update(e.param.data.vWeekRankItem)}),$.ajax({url:TT.app.main+"cache5min.php?m=WeekRank&do=getItemsByPid&pid="+anchor.lp,type:"GET",dataType:"json",success:function(e){var n=[];e&&0==e.error&&e.data&&e.data.vWeekRankItem&&e.data.vWeekRankItem.length&&(n=e.data.vWeekRankItem),update(n)}})});