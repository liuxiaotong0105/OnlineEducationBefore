define("widget/roomGgTop",function(o,t,e){function i(o,t,e){function i(){p.remove(),a.emit("close");try{ya.reportProductEvent({eid:"click/room/gg/top/close",eid_desc:"\u70b9\u51fb/\u76f4\u64ad\u95f4/\u5e7f\u544a/top/\u5173\u95ed"})}catch(o){}}var a=$.extend(this,new n),c='.room-mod-ggTop{position:relative}.room-gg-top{position:relative;overflow:hidden;border-radius:5px;margin-bottom:10px;font-family:"Microsoft YaHei"}.room-gg-top .pic{display:block;width:100%;text-align:center}.room-gg-top .pic img{max-width:100%}.room-gg-top .ps{position:absolute;top:0;right:0;line-height:2;padding:0 8px;background-color:#000;color:#fff;border-top-right-radius:5px;opacity:.7}';r.importStyle(c);var p=$('<div class="room-gg-top"><a class="pic J_pic"'+($.trim(o.jump_url)?"":' style="cursor: default;"')+' href="'+$.trim(o.jump_url)+'" title="'+_.escape(o.title)+'" target="_blank"></a><span class="ps">\u5e7f\u544a</span></div>');p.find(".J_pic").append(e),p.css({position:"absolute",visibility:"hidden",width:"100%",left:0,top:0}),$(t).append(p);var l=p.height();p.css({height:0,position:"",visibility:""}),p.animate({height:l},1e3,function(){p.css({height:""})});try{TT_RSC_EXPS({pos:"room/gg/top",rsc:o.id})}catch(s){}var g=0,d=5==o.close_way?o.close_click_count:1/0;p.on("click",".J_pic",function(t){$.trim(o.jump_url)||t.preventDefault();try{ya.reportProductEvent({eid:"click/position",position:"room/gg/top",resourceid:o.id})}catch(t){}++g>=d&&i()})}function a(o,t){var e="//g.huya.com/cache1min.php?m=Api&do=getPositionContent&position_id=6";return $.ajax({url:e,type:"GET",dataType:"jsonp",jsonpCallback:"roomGgTopJsonpCallback",data:{pid:o,gid:t},cache:!0})}var r=o("tools"),n=o("Event");e.exports=function(o,t,e,n){a(o,t).done(function(o){function t(o){localStorage.removeItem(g),r.loadImg(TT.trimUrl(o.img_url),function(t){var a=new i(o,e,t);localStorage.setItem(p,(new Date).getTime()+""),5==o.close_way&&a.on("close",function(){localStorage.setItem(g,(new Date).getTime()+1e3*o.close_duration+"")})})}var a=null,c=r.once(n);if(200==o.status&&o.data&&(a=o.data[0])){var p="TT_ROOM_GG_TOP_LATEST_"+TT.env,l=parseInt(localStorage.getItem(p)||"0",10),s=3e5;if((new Date).getTime()>l+s){var g="TT_ROOM_GG_TOP_CD_"+a.id+"_"+TT.env;if(2==a.close_way)t(a),c(1);else if(5==a.close_way){var d=localStorage.getItem(g)||"0";(new Date).getTime()>parseInt(d,10)&&(t(a),c(1))}}}c(0)})}});