define("chatRoom/ScrollbarModel",function(n,t,e){function o(n){function t(){return z>m}function e(n){i(n)&&n>=0&&(m=n,f.emit("resize",0))}function o(n){i(n)&&n>0&&(z=n,f.emit("resize",1))}function c(){!u()&&l(z-m)}function u(){return h&&S+m>=z}function l(n){h&&i(n)&&(S=Math.max(0,Math.min(n,z-m)),f.emit("scroll"))}function a(n){l(S+n)}function s(){return m/z}var f=$.extend(this,new r),m=Math.max(n.containerSize,0),z=Math.max(n.contentSize,1),S=0,h=t();f.on("resize",function(){var n=h;if(h=t()){var e=z-m;S>e&&l(e)}else 0!==S&&(S=0,f.emit("scroll"));h!=n&&f.emit("scrollableChange",h)}),$.extend(this,{containerSize:function(){return m},contentSize:function(){return z},scale:s,scrollTop:function(){return S},scrollable:function(){return h},isAtBottom:u,setContainerSize:e,setContentSize:o,scrollToBottom:c,setScrollTop:l,upScrollTop:a})}function i(n){return"number"==typeof n&&!isNaN(n)&&isFinite(n)}var r=n("Event");e.exports=o});
;define("chatRoom/ScrollbarView",function(o,c,e){function t(o){function c(){o.bottomed?(o.off("scroll",e),a.css("top","auto"),a.css("bottom",0)):(a.css("top",-o.scrollTop()),a.css("bottom","auto"),o.on("scroll",e))}function e(){a.css("top",-o.scrollTop())}function t(){m[o.scrollable()?"show":"hide"]()}function s(){var c=o.scrollable()?Math.max(20,o.containerSize()*o.scale()):o.containerSize();i.height(c)}function n(){o.bottomed?(o.off("scroll",l),o.off("resize",l),i.css("top","auto"),i.css("bottom",0)):(i.css("top",o.scrollTop()*o.scale()),i.css("bottom","auto"),o.on("scroll",l),o.on("resize",l))}function l(){i.css("top",o.scrollTop()*o.scale())}function r(){var c,e;i.on("mousedown",function(t){return c=t.pageY,$(document).on("mousemove.scroll_move",function(t){return o.lockCd(),e=t.pageY-c,c=t.pageY,o.upScrollTop(e/o.scale()),!1}),$(document).on("mouseup.scroll_move",function(){$(document).off("mousemove.scroll_move").off("mouseup.scroll_move")}),!1}),u.on("mousewheel",function(c,e){return o.upScrollTop(0>e?50:-50),o.lockCd(),!1})}var u=$("#chat-room__wrap"),a=$("#chat-room__list"),m=$(".scroll_bar"),i=$(".scroll_move");c(),o.on("bottomedChange",c),t(),o.on("scrollableChange",t),s(),o.on("resize",s),n(),o.on("bottomedChange",n),r()}e.exports=t});
;define("chatRoom/scrollbar",function(o,t,e){var c=o("tools"),n=o("chatRoom/ScrollbarModel"),l=o("chatRoom/ScrollbarView"),i=new n({containerSize:$("#chat-room__wrap").height(),contentSize:$("#chat-room__list").height()});i.locked=!1,i.lock=function(){!i.locked&&i.scrollable()&&i.emit("lockedChange",i.locked=!0)},i.unlock=function(){i.locked&&i.emit("lockedChange",i.locked=!1)},i.lockCd=c.debounce(function(){i.unlock()},15e3),i.on("resize",function(){i.locked||i.scrollToBottom()}),i.bottomed=i.isAtBottom(),i.on("resize",function(){i.bottomed!==i.isAtBottom()&&i.emit("bottomedChange",i.bottomed=!i.bottomed)}),i.on("scroll",function(){i.bottomed!==i.isAtBottom()&&i.emit("bottomedChange",i.bottomed=!i.bottomed)}),i.on("scroll",function(){i.scrollable()&&(i.isAtBottom()?i.unlock():i.lock())}),i.on("lockedChange",function(o){o&&i.lockCd()}),new l(i),e.exports=i});
;define("chatRoom/useUcard",function(e){var t=e("msgManager"),i=e("chatRoom/scrollbar"),o=e("widget/dialog").layer,n=e("widget/ucard"),c=e("tools"),a=null,d=null,l=function(){a&&a.close(),d=a=null},r=function(e,t){d&&d.lUid==e||n({uid:e,muteText:t,init:function(e){a&&a.close(),d=e.data,a=o({view:e.view,zIndex:199,lock:!1,container:".room-sidebar"}),$(window).resize(c.debounce(function(){a&&a.center()},60))},close:l,destroy:l})};$(".room-sidebar").on("click",function(e){a&&a.view[0]!==e.target&&!a.view.find(e.target).length&&l()}),$("#chat-room__list").on("click",".J_userMenu",function(e){e.preventDefault(),i.lock(),i.lockCd();var o=$(this),n=o.closest("[data-id]").data("id"),c=n?t.get(n):null;if(c&&c.data){r(c.data.uid,c.data.msg);try{ya.reportProductEvent({eid:"click/zhibo/gp/yhm",eid_desc:"\u70b9\u51fb/\u76f4\u64ad/\u516c\u5c4f/\u7528\u6237\u540d"})}catch(e){}}})});
;define("chatRoom",function(e){var o=e("TTP"),n=e("TTA"),t=e("msgManager"),c=e("tools"),i=e("chatRoom/scrollbar"),a=e("chatPanelFilter"),l=$("#chat-room__list"),r=c.throttle(function(){i.setContentSize(l.height()||1)},120);t.on("msg",r),t.on("cls",r);var s=$("#chat-room__wrap"),d=c.debounce(function(){i.setContainerSize(s.height())},60);DUYA_SUB.subscribe("resizeWide",d),DUYA_SUB.subscribe("resizereinitialise",d);var u=document.getElementById("more-msg");$(u).on("click",function(e){e.preventDefault(),i.scrollToBottom()}),t.on("msg",function(){i.scrollable()&&!i.bottomed&&(u.style.display="block")}),i.on("bottomedChange",function(){i.bottomed&&(u.style.display="none")}),i.on("scrollableChange",function(){i.scrollable()||(u.style.display="none")});var f=$(".lockBtn");i.on("lockedChange",function(e){e?f.addClass("locked").find("span").text("\u89e3\u9501"):f.removeClass("locked").find("span").text("\u9501\u5c4f")}),f.on("click",function(e){e.preventDefault();var o=i.locked;o?i.unlock():i.lock();try{ya.reportProductEvent({eid:"click/zhibo/gp/"+(o?"unlock":"lock"),eid_desc:"\u70b9\u51fb/\u76f4\u64ad/\u516c\u5c4f/"+(o?"\u89e3\u9501":"\u9501\u5c4f")})}catch(e){}});var p=$(".clearBtn");p.on("click",function(e){e.preventDefault(),i.unlock(),t.clear();try{ya.reportProductEvent({eid:"click/zhibo/gp/cls",eid_desc:"\u70b9\u51fb/\u76f4\u64ad/\u516c\u5c4f/\u6e05\u5c4f"})}catch(e){}}),a.on("update:lockAndClearBtn",function(){var e=$("#wrap-"+a.topPanel()),o=e.length?e.height()+10+"px":"10px";f.css("top",o),p.css("top",o)}),i.on("lockedChange",function(e){t[e?"gc_close":"gc_open"]()}),function(){function e(e){var o=e.param?e.param:e;$("#watchChat_pub").css("background-image","url("+TT.trimUrl(o.data.sWebPicUrl)+")")}function t(){$("#watchChat_pub").css("background-image","")}o.isH5?o.ready(function(o){o.addTafListener("getScreenSkin",function(n){0==n.iRetCode&&e(n),o.removeTafListener("getScreenSkin")});var c=new HUYA.getScreenSkinReq;c.tId=o.userId,c.lPresenterUid=n.lp,c.iTemplate=0,c.iFromType=5,o.sendWup("liveui","getScreenSkin",c),o.addTafListener("6640",e),o.addTafListener("6641",t)}):(o.on("showScreenSkinNotify",e,!0),o.on("hideScreenSkinNotify",t,!0))}(),e("chatRoom/useUcard");var h,m=e("widget/fansBadgeAnchor"),g={close:function(){}};$("#chat-room__list").on("mouseenter",".fans-icon",function(){var e=$(this),o=e.data("id"),n=e.data("type");if(o&&o!=h&&1!=n){g.close(),h=o;var t,c=e.offset(),i=$(window).scrollLeft()+c.left+e.outerWidth()/2,a=$(window).scrollTop()+c.top+e.outerHeight();m({uid:o,init:function(n){if(o==h){var c=$("<div></div>").css({paddingTop:30,top:a-30+5,left:i-18,zIndex:999,position:"absolute"});g={close:function(){n.close(),c.remove(),e.off("mouseleave"),h=void 0,this.close=function(){}}},e.on("mouseleave",function(){t=setTimeout(function(){g.close()},100)}),c.on("mouseleave",function(){g.close()}).on("mouseenter",function(){clearTimeout(t)}),c.append(n.view),c.appendTo("body")}}})}})});