define("fans_rank",function(require,exports,module){var TTP=require("TTP"),TTA=require("TTA"),tab=require("rankTab"),ucard=require("widget/ucard"),tools=require("tools"),fansIcon=require("widget/fans-icon");require("jScrollPane");var Rank=function(data){function render(e){rankList.html(tpl(e)),scrollbar?e&&e.vItem&&e.vItem.length!=size&&(size=e.vItem.length,scrollbarReinit()):(scrollbar=box.jScrollPane({mouseWheelSpeed:20,verticalGutter:0,isOutsideNotPrevent:!1}).data("jsp"),scrollbarReinit=tools.debounce(function(){scrollbar.reinitialise()},100))}function bind(){var e=null,n=box.closest(".week-rank__unit"),t=n.height();rankList.on("mouseenter",function(){var i=box.height();i>t&&(e&&clearTimeout(e),e=setTimeout(function(){n.stop().animate({height:i})},300))}).on("mouseleave",function(){e&&clearTimeout(e),n.stop().animate({height:t})}),TTP.ready(function(){var e;rankList.on("mouseenter",".J_name",e=tools.debounce(function(n){var t=null,i=null,a=$(window).scrollLeft()+Math.min(n.clientX+15,$(window).width()-260),l=$(window).scrollTop()+Math.min(n.clientY+10,$(window).height()-340),r=$(this).closest("li"),o=list[r.index()];o&&ucard({uid:o.lUid,muteText:"\u7c89\u4e1d\u699c",init:function(n){i=n,n.view.css({left:a,top:l,zIndex:10,position:"absolute"}),n.view.find(".ucard-x").hide(),n.view.on("mouseenter",function(){clearTimeout(t),e.cancel()}).on("mouseleave",function(){n.destroy()}),n.view.appendTo("body");try{ya.reportProductEvent({eid:"click/zhibo/kp/fst",eid_desc:"\u70b9\u51fb/\u76f4\u64ad/\u7528\u6237\u5361\u7247/\u7c89\u4e1d\u699c"})}catch(r){}}}),$(this).on("mouseleave",function(){t=setTimeout(function(){i&&i.destroy()},200)})},800)).on("mouseleave",function(){e&&e.cancel()})})}function update(e){data=e,render(data)}var list=data.vItem||[],size=list.length,tpl=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{}){if(__p+="",vItem&&vItem.length){for(var len=vItem.length,i=0;len>i;i++){var tip="";0==i?tip="num-one":1==i?tip="num-two":2==i&&(tip="num-three");var item=vItem[i],iNobleLevel=item.iNobleLevel,sNickName=_.escape(item.sNickName),iLevel=item.iUserLevel,iBadgeLevel=item.iBadgeLevel,iScore=item.iScore;__p+='\r\n        <li>\r\n        \r\n            <span class="item-num '+(null==(__t=tip)?"":__t)+'">'+(null==(__t=i+1)?"":__t)+"</span>\r\n\r\n            ",iNobleLevel>0&&(__p+='\r\n                <span class="noble-icon noble-level-'+(null==(__t=iNobleLevel)?"":__t)+'"></span>\r\n            '),__p+='\r\n            <span class="week-rank-name J_name">'+(null==(__t=sNickName)?"":__t)+'</span>\r\n            <span class="level-icon level-icon'+(null==(__t=iLevel)?"":__t)+'"></span>\r\n            <span class="fansScore">'+(null==(__t=tools.format(iScore))?"":__t)+"</span>\r\n            "+(null==(__t=fansIcon.create(iBadgeLevel,sBadgeName,lBadgeId,iBadgeType))?"":__t)+"\r\n        </li>\r\n"}__p+="\r\n\r\n    ",vItem.length>3&&(__p+='\r\n        <li class="showMore">\u6309\u6700\u8fd17\u5929\u7c89\u4e1d\u4eb2\u5bc6\u5ea6\u4e0a\u5347\u6392\u884c</li>\r\n   '),__p+="\r\n"}else __p+='\r\n    <div class="no-rank-tip">'+(null==(__t=lBadgeId>0?"\u4e00\u6b21\u6027\u9001\u51fa10\u4e2a\u5c0f\u793c\u7269\u4e0a\u699c":"\u4e3b\u64ad\u6682\u672a\u5f00\u901a\u7c89\u4e1d\u5fbd\u7ae0")?"":__t)+"</div>\r\n";__p+="\r\n\r\n"}return __p},rankList=$("#J_fansRankList"),box=$("#J_fansRankBox"),scrollbar=null,scrollbarReinit=null;return render(data),bind(),{update:update}},getData=function(e){$.ajax({url:TT.app.main+"cache.php?m=Fans&do=getFansScoreUpList&profileUid="+TTA.lp,dataType:"json",success:function(n){n&&200==n.status&&n.data&&e(n.data)}})},createRank=function(){var e=null,n=function(n){e?e.update(n):e=new Rank(n)},t=0;return function(){0===t&&(getData(n),t=1,setTimeout(function(){t=0},6e4))}}();1===tab.getIndex()&&createRank(),tab.change(function(e){1===e&&createRank()})});