define("widget/roomEmot",function(require,exports,module){function EmotView(container,emot,size){function render(){var e=emot.faces.concat(new Array(size)).slice(0,size),t=tpl({faces:e});container.html(t)}function bind(){container.on("click.emot",".J_emotItem",function(e){e.preventDefault();var t=$(this).data("key"),o=t?Emot.faceMap[t]:null;o&&emot.select(o)})}function open(){!isVisible&&emot.faces.length&&(isVisible=!0,container.show(),roomEmot.emit("open"))}function close(){isVisible&&(isVisible=!1,container.hide(),roomEmot.emit("close"))}var roomEmot=$.extend(this,new Event),tpl=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="emot-panel">\n    <ul class="emot-list">\n        ',$.each(faces,function(e,t){__p+=t?'\n                <li class="emot-item J_emotItem" data-key="'+(null==(__t=t.key)?"":__t)+'"><img src="'+(null==(__t=t.img)?"":__t)+'" alt="'+(null==(__t=t.alt)?"":__t)+'" /></li>\n        ':'\n                <li class="emot-item J_emotItem"></li>\n        '}),__p+="\n    </ul>\n</div>";return __p},cssText='.emot-panel{background:#fff}.emot-panel .emot-list{zoom:1}.emot-panel .emot-list:before,.emot-panel .emot-list:after{display:table;content:""}.emot-panel .emot-list:after{clear:both}.emot-panel .emot-list .emot-item{float:left;position:relative;margin:0 -1px -1px 0;width:32px;height:32px;border:1px solid #E8E8E8;text-align:center}.emot-panel .emot-list .emot-item img{margin-top:5px}.emot-panel .emot-list .emot-item:hover{z-index:1;border-color:#f80;background:#FFEAD3}.chat-emot{position:absolute;bottom:100%;right:0;width:331px;padding:3px;border:1px solid #d2d2d2;box-shadow:1px 1px 3px rgba(0,0,0,.15);border-radius:3px;background:#fff}.chat-emot:after{content:"";position:absolute;left:17px;bottom:-6px;width:10px;height:6px;background:url(https://a.msstatic.com/huya/main/img/room/room_grow_arrow_32e4528.png?__sprite)}.chat-emotLnk{position:absolute;bottom:100%;left:0;width:131px;padding:3px;border:1px solid #d2d2d2;box-shadow:1px 1px 3px rgba(0,0,0,.15);border-radius:3px;background:#fff}.chat-emotLnk:after{content:"";position:absolute;left:17px;bottom:-6px;width:10px;height:6px;background:url(https://a.msstatic.com/huya/main/img/room/room_grow_arrow_32e4528.png?__sprite)}.chat-emotLnk .emot-panel{margin:-1px 0 0 -1px;width:133px}';tools.importStyle(cssText,"style_roomEmot"),render(),bind(),emot.on("update",render);var isVisible=!1;$.extend(this,{open:open,close:close,visible:function(){return isVisible},toggle:function(){isVisible?close():open()}})}var Event=require("Event"),tools=require("tools"),TextAreaHelper=require("TextAreaHelper"),Emot=require("Emot"),roomInputObj=require("input_ob"),getTah=tools.once(function(){return new TextAreaHelper(document.getElementById("pub_msg_input"))}),g_emot=new Event;g_emot.visible=!1,function(){var e=null,t=null;$("#J_inputEmot").on("click",function(o){o.preventDefault(),e||(e=new Emot(Emot.faces),t=new EmotView($("#J_chatEmot"),e,40),e.on("select",function(e){Emot.history.add(e),getTah().insertText(e.alt),roomInputObj.checkWordsLeft();try{ya.reportProductEvent({eid:"click/zhibo/emot",eid_desc:"\u70b9\u51fb/\u76f4\u64ad\u95f4/\u8868\u60c5\u8f93\u5165"})}catch(t){}}),t.on("open",function(){$("body").on("click.emotHide",function(e){"J_inputEmot"!=e.target.id&&t.close()})}),t.on("close",function(){$("body").off("click.emotHide")}),t.on("open",function(){g_emot.emit("open",g_emot.visible=!0)}),t.on("close",function(){g_emot.emit("close",g_emot.visible=!1)})),t.toggle()})}(),function(){function e(){g_emot.visible||(clearTimeout(n),r.open())}function t(){clearTimeout(n),n=setTimeout(function(){r.close()},200)}if("localStorage"in window){var o=$("#J_chatEmotLnk"),n=null,i=null,r=null;$("#J_inputEmot").on("mouseenter",function(){if(!i){var e=Emot.history.getData();i=new Emot(e),r=new EmotView(o,i,16),Emot.history.on("update",function(e){i.update(e)}),i.on("select",function(e){getTah().insertText(e.alt),roomInputObj.checkWordsLeft();try{ya.reportProductEvent({eid:"click/zhibo/emot",eid_desc:"\u70b9\u51fb/\u76f4\u64ad\u95f4/\u8868\u60c5\u8f93\u5165"})}catch(t){}})}}).on("mouseenter",e).on("mouseleave",t),o.on("mouseenter",e).on("mouseleave",t),g_emot.on("open",function(){r.close()})}}()});