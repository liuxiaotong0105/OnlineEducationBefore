define("widget/room-youlike",function(require,exports,module){function RoomYoulike(){this.initialize.apply(this,arguments)}var format=require("formatNumber"),TTR=require("TTR"),TTA=require("TTA"),tools=require("tools");require("imgLazyLoad"),require("roomRespondCard"),RoomYoulike.prototype={initialize:function(){var _this=this;_this.type="youlike",tools.exposure($(".room-footer")[0],function($elm){TTR.gid?(window.IS_UNION?_this.getData2:_this.getData)(function(data,type){data.length<=6&&$(".youlike-page").remove(),_this.type=type||"youlike",_this.dataList=data;var titleTmpl=function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+="",__p+="recom"==obj.type?'\n<i class="youlike-title-icon"></i>\u731c\u4f60\u559c\u6b22\n':'\n<i class="youlike-title-icon"></i>\u770b\u5b98\u63a8\u8350\n<div class="youlike-ques">\n    <div class="youlike-ques-cnt">\u770b\u5b98\u63a8\u8350\u662f\u53c2\u8003\u4e86\u7528\u6237\u5206\u4eab\u91cf\u7684\u7efc\u5408\u6392\u5e8f\uff0c\u5728\u79fb\u52a8\u7aef\u7684\u5206\u4eab\u8d8a\u591a\uff0c\u6392\u540d\u8d8a\u9ad8\u54e6\uff01<span></span></div>\n    <em></em>\n</div>\n',__p+="";return __p};$(".youlike .j_title").html(titleTmpl({type:_this.type})),_this.tmpl=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{}){__p+="";for(var i=0,len=list.length;len>i;i++){var data=list[i];__p+='\n<li class="game-live-item" gid="'+(null==(__t=data.gid)?"":__t)+'">\n    ';var url="",target="";window.IS_UNION?(url=TT.app.main+"union/"+TT.createRoomHost(data.privateHost,data.profileRoom)+"?promoter="+TT.promoter,target="_self"):(url=TT.app.main+TT.createRoomHost(data.privateHost,data.profileRoom),target="_blank");var seat="";if(1==data.screenType&&2==data.liveSourceType)var screenshot=TT.createScreenshot(data.screenshot,{w:190,h:338,r:270});else var screenshot=TT.createScreenshot(data.screenshot,{w:338,h:190});seat="undefined"==typeof rankStart?position+"/"+(i+1):position+"/"+(rankStart+i);var nick="",introduction="";if("undefined"!=typeof noEscape&&noEscape?(nick=data.nick,introduction=data.introduction):(nick=_.escape(data.nick),introduction=_.escape(data.introduction)),__p+='\n    <a href="'+(null==(__t=url)?"":__t)+'" class="video-info new-clickstat '+(null==(__t=data.imgRecInfo?"clickstat":"")?"":__t)+'" target="'+(null==(__t=target)?"":__t)+'" report=\'{"eid":"'+(null==(__t=eid)?"":__t)+'","position":"'+(null==(__t=seat)?"":__t)+'","game_id":"'+(null==(__t=data.gid)?"":__t)+'","ayyuid":"'+(null==(__t=data.uid)?"":__t)+'","hot_factor":"'+(null==(__t=data.rankLabel)?"":__t)+"\"}' ",data.imgRecInfo&&(__p+=' eid="click/position/'+(null==(__t=data.gid)?"":__t)+"/"+(null==(__t=data.imgRecInfo.type)?"":__t)+"/"+(null==(__t=data.uid)?"":__t)+'" eid_desc="\u70b9\u51fb/\u4f4d\u7f6e/'+(null==(__t=data.gameFullName)?"":__t)+"/"+(null==(__t=data.imgRecInfo.typeDesc)?"":__t)+"/"+(null==(__t=data.uid)?"":__t)+'" '),__p+='>\n        <img class="pic" data-original="'+(null==(__t=TT.trimUrl(screenshot))?"":__t)+'" src="//a.msstatic.com/huya/main/assets/img/default/338x190.jpg" onerror="this.onerror=null; this.src=\'//a.msstatic.com/huya/main/assets/img/default/338x190.jpg\';" alt="'+(null==(__t=nick)?"":__t)+'\u7684\u76f4\u64ad" title="'+(null==(__t=nick)?"":__t)+'\u7684\u76f4\u64ad">\n\n        ',data.isGaming&&1==data.isGaming)__p+='\n        <em class="tag tag-gaming"></em>\n        ';else{if(__p+="\n            ",data.attribute&&data.attribute.ListPos1){var tagIcon=TT.trimUrl(data.attribute.ListPos1.sIcon.replace("<ua>","3").replace("<client>","web"));__p+='\n            <em class="tag-leftTop" style="background-image: url('+(null==(__t=tagIcon)?"":__t)+');"></em>\n            '}else data.recommendTagName&&(__p+='\n            <em class="tag tag-recommend">'+(null==(__t=data.recommendTagName)?"":__t)+"</em>\n            ");__p+="\n        "}if(__p+='\n\n        <div class="item-mask"></div>\n        <i class="btn-link__hover_i"></i>\n\n        <p class="tag-right">\n\n        <!-- \u84dd\u5149 -->\n        ',"undefined"==typeof rankStart&&1==data.isBluRay&&(__p+='\n            <em class="tag-blue">\u84dd\u5149'+(null==(__t=data.bluRayMBitRate)?"":__t)+"</em>\n        "),__p+="\n\n        <!-- \u76f4\u64ad\u95f4\u63a8\u8350rank -->\n        ","undefined"!=typeof rankStart&&(__p+='\n            <em class="tag-rank tag-rank-'+(null==(__t=rankStart+i)?"":__t)+'">No.'+(null==(__t=rankStart+i)?"":__t)+"</em>\n        "),__p+="\n        \n        ",data.imgRecInfo){var tagType=data.imgRecInfo.type,tagValue=data.imgRecInfo.value;__p+="\n            ","killNum"==tagType&&tagValue>0?__p+='\n                <!-- \u51fb\u6740 -->\n                <em class="tag-save"><i class="save-amount">'+(null==(__t=tagValue)?"":__t)+'</i><i class="save-icon">\u51fb\u6740</i></em>\n            ':"aliveNum"==tagType&&tagValue>0&&30>=tagValue?__p+='\n                <!-- \u5b58\u6d3b -->\n                <em class="tag-save"><i class="save-amount">'+(null==(__t=tagValue)?"":__t)+'</i><i class="save-icon">\u5b58\u6d3b</i></em>\n            ':"isDancing"==tagType&&tagValue>0?__p+='\n                <!-- \u70ed\u821e -->\n                <em class="tag-dancing">\u70ed\u821e\u4e2d</em>\n            ':"isSinging"==tagType&&tagValue>0&&(__p+='\n                <!-- \u5531\u6b4c -->\n                <em class="tag-singing">\u5531\u6b4c\u4e2d</em>\n            '),__p+="\n        "}if(__p+="\n        </p>\n\n        <!-- \u5206\u4eab -->\n        ",data.rankLabel&&(__p+='\n            <em class="tag tag-hot">'+(null==(__t=data.rankLabel)?"":__t)+"</em>\n        "),__p+='\n    </a>\n    <a href="'+(null==(__t=url)?"":__t)+'" class="title new-clickstat" target="'+(null==(__t=target)?"":__t)+'" report=\'{"eid":"'+(null==(__t=eid)?"":__t)+'","position":"'+(null==(__t=seat)?"":__t)+'","game_id":"'+(null==(__t=data.gid)?"":__t)+'","ayyuid":"'+(null==(__t=data.uid)?"":__t)+'"}\' title="'+(null==(__t=introduction)?"":__t)+'">'+(null==(__t=introduction)?"":__t)+'</a>\n    <span class="txt">\n        <span class="avatar fl">\n            <img data-original="'+(null==(__t=TT.trimUrl(data.avatar180))?"":__t)+'" src="//a.msstatic.com/huya/main/assets/img/default/84x84.jpg" onerror="this.onerror=null; this.src=\'//a.msstatic.com/huya/main/assets/img/default/84x84.jpg\';" alt="'+(null==(__t=nick)?"":__t)+'" title="'+(null==(__t=nick)?"":__t)+'">\n            <i class="nick" title="'+(null==(__t=nick)?"":__t)+'">'+(null==(__t=nick)?"":__t)+"</i>\n        </span>\n        ",gameType){if(""!=data.gameHostName)var gameTypeUrl=TT.app.main+"g/"+data.gameHostName;else var gameTypeUrl=TT.app.main+"g/"+data.gid;__p+='\n        <span class="game-type fr"><a target="_blank" href="'+(null==(__t=gameTypeUrl)?"":__t)+'" title="'+(null==(__t=data.gameFullName)?"":__t)+'">'+(null==(__t=data.gameFullName)?"":__t)+"</a></span>\n        "}__p+='\n        <span class="num"><i class="num-icon"></i><i class="js-num">'+(null==(__t=format.formatNumber(data.totalCount))?"":__t)+"</i></span>\n    </span>\n</li>\n"}__p+="\n"}return __p},_this.$youlikeList=$("#youlike-list"),_this.createHtml(1,6),$(".youlike-page").length>0&&_this.bindEvent(),DUYA_SUB.publish("roomRespondCard")},function(){$(".youlike").remove(),$(".comp_huya_match_guess_new").remove()}):($(".youlike").remove(),$(".comp_huya_match_guess_new").remove())},-60,$("#main_col"))},createHtml:function(t,a){var e=this,n={list:this.dataList.slice(t-1,a),eid:"click/position",position:"recom"==e.type?"room/recom":"room/cnxh",gameType:!0};"youlike"==e.type&&(n.rankStart=t),this.$youlikeList.html(this.tmpl(n)),this.$youlikeList.find("img").lazyload({container:$("#main_col")});var i=HUYA_UTIL.once(function(){e.$youlikeList.find("img").trigger("appear")});$(window).one("load.youlike",i),setTimeout(i,3500),setTimeout(function(){e.pageview()},0)},pageview:function(){var t=this,a=t.$youlikeList.find(".game-live-item .video-info");$.each(a,function(t,a){tools.exposure(a,function(t){function a(){return"undefined"==typeof ya?void(e=setTimeout(function(){a()},1e3)):(clearTimeout(e),void ya.reportProductEvent(n))}var e,n=$.parseJSON(t.attr("report").replace("click","pageview"));a()},-60,$("#main_col"))})},getData2:function(t,a){$.ajax({type:"get",url:TT.app.main+"/union/cache.php?m=LiveList&do=ajaxRecGameLive",dataType:"json",data:{appId:TT.promoter,gameId:TTR.gid}}).done(function(e){200==e.status&&e.data&&e.data.datas&&e.data.datas.length?t(e.data.datas):a()})},getData:function(t,a){function e(){var t=new $.Deferred;return TT.getUserInfo(function(a){a.isLogined?$.getJSON(TT.app.main+"index.php",{m:"RecommendLive","do":"getProfileRecommendList",gid:TTR.gid,pid:TTA.lp},function(a){t.resolve(200==a.status&&a.data.length>0?a.data:[])}):t.resolve([])}),t.promise()}function n(){var t=new $.Deferred;return $.getJSON(TT.app.main+"cache10min.php",{m:"Live","do":"getProfileRecommendList",gid:TTR.gid},function(a){t.resolve(200==a.status&&a.data.length>0?a.data:[])}),t.promise()}$.when(e(),n()).done(function(e,n){e.length?t(e,"recom"):n.length?t(n):a()})},bindEvent:function(){function t(){var t=3*(n-1)+1,a=3*n+3>=i.dataList.length?i.dataList.length:3*n+3;i.createHtml(t,a)}var a=$(".youlike-prev"),e=$(".youlike-next"),n=1,i=this;a.on("click",function(){var a=$(this);return a.hasClass("disable")?!1:(e.removeClass("disable"),n--,1==n&&a.addClass("disable"),void t())}),e.on("click",function(){var e=$(this);return e.hasClass("disable")?!1:(a.removeClass("disable"),n++,3*n+3>=i.dataList.length&&e.addClass("disable"),void t())})}},module.exports=RoomYoulike});