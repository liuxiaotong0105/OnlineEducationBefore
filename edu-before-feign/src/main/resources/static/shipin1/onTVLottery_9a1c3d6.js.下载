define("onTVLottery",function(e,n,t){function a(e){var n=1e4;return e>=n?(1e3>e%n?parseInt(e/n):(e/n).toFixed(1))+"\u4e07":e}function i(e){"undefined"==typeof e&&(e=S.fansLevel);var n=S.tvType,t=(S.tvColor,L.tv[n]);e>=t.forFree&&0!=t.forFree?(S.price=0,S.priceFormat=0):(S.price=t.price,S.priceFormat=a(t.price))}function r(){var e=C.defaultGift.type;if(B.isFlash){var n=U.concat(e);d(n,function(t){TT.log("getBadgeItemByTypeReq",n,t),C.defaultGift.name=t.param[e]&&t.param[e].sPropsName;for(var a=L.pack,i=0;i<a.length;i++){var r=a[i];t.param[r.giftId]&&(a[i].giftIcon=t.param[r.giftId].vPropsIdentity.value[0].sPropsPic24.replace("&","?"))}A.emit("update:sendPanel")})}else{h=function(){var e=window.sessionStorage.getItem("propsDict");return e?JSON.parse(e):null}(),C.defaultGift.name=h[e]&&h[e].sPropsName;for(var t=L.pack,a=0;a<t.length;a++){var i=t[a];h[i.giftId]&&(t[a].giftIcon=h[i.giftId].vPropsIdentity.value[0].sPropsPic24.replace("&","?"))}A.emit("update:sendPanel")}}function o(e){function n(){var e=i.vTVPrice.value,n=[{forFree:e[0].iFreeFansLevel,type:"\u9ed1\u767d",price:e[0].iPrice,amount:1},{forFree:e[1].iFreeFansLevel,type:"\u5f69\u7535",price:e[1].iPrice,amount:5},{forFree:e[2].iFreeFansLevel,type:"\u5927\u5f69\u7535",price:e[2].iPrice,amount:3}];return n}function t(){for(var e=i.vPack.value,n=[],t=0;t<e.length;t++){var a=e[t];U.push(a.iItemId),n.push({giftId:a.iItemId,amount:a.iItemNum,type:a.iTVType,color:a.iTVColor,msg:a.sContent})}return S.giftTVChoice>=e.length&&(S.giftTVChoice=0),n}function a(){var n={mode:i.iAwardMode,gameId:e.tInfo.lOnTVId,theme:i.sTitle,awardAmount:i.tAward.iAwardNum,award:i.tAward.sAwardName,receivedAmount:e.tInfo.tData.iBarrageNum,partic:i.iPartic};if(e.iIsDiy){var t=e.tDiy;n=$.extend({},!0,n,{isDiy:{msgIcon:t.tBarrage.sIcon.replace("<size>","26_26").replace("<ua>","web"),nick:t.tPanel.sName,ad:t.tPanel.sAD,adLink:t.tPanel.sADJump,specialUI:function(){return t.tPanel.sUIJson?JSON.parse(t.tPanel.sUIJson):!1}()},anchorImg:t.tPanel.sLogo||i.sLogo})}else n=$.extend({},!0,n,{isDiy:!1,anchorImg:i.sLogo});return n}var i=e.tInfo.tSettingInfo;U=[],w=$.extend({},!0,w,a()),L={tv:n(),pack:t()},r(),A.emit("update:sendPanel")}function u(e){TT.log("resultData",e);var n=e.tAward,t=n.vInfo.value;w.gameId=n.lOnTVId,w.isDiy=function(){var n=e.tDiy;return{msgIcon:n.tBarrage.sIcon.replace("<size>","26_26").replace("<ua>","web"),nick:n.tPanel.sName,ad:n.tPanel.sAD,adLink:n.tPanel.sADJump,specialUI:function(){return n.tPanel.sUIJson?JSON.parse(n.tPanel.sUIJson):!1}()}}();for(var a=[],i=0;i<t.length;i++){var r=t[i];a.push({playerImg:r.sLogo,nick:r.sNickName,color:D[r.tBarrage.iTVColor],msg:r.tBarrage.sContent,gift:r.sAwardName})}O={result:a},A.emit("update:resultPanel")}function d(e,n){B.ready(function(){B.one("getBadgeItemByTypeRsp",function(e){n&&n(e)}),B.call("getBadgeItemByType",{value:e})})}function c(e){B.ready(B.isH5?function(n){var t=new HUYA.OnTVUserReq;t.tUserId=n.userId,t.lPid=V.lp,t.lTid=P.id,t.lSid=P.sid,n.sendWup2("revenueui","getOnTVPanel",t,function(n){e&&e(n)})}:function(n){B.one("getOnTVPanelRsp",function(n){e&&e(n.param)}),n.callAs("getOnTVPanel",{lPid:V.lp,lTid:P.id,lSid:P.sid})})}function s(e){B.ready(B.isH5?function(n){var t=new HUYA.OnTVUserReq;t.tUserId=n.userId,t.lPid=V.lp,t.lTid=P.id,t.lSid=P.sid,n.sendWup2("revenueui","getOnTVUserInfo",t,function(n){e&&e(n)})}:function(n){B.one("OnTVUserInfoRsp",function(n){e&&e(n.param)}),n.callAs("getOnTVUserInfo",{lPid:V.lp,lTid:P.id,lSid:P.sid})})}function f(e){function n(n){e&&e(n),f=function(e){e&&e(n)}}B.ready(B.isH5?function(e){var t=new HUYA.BadgeItemReq;t.tUserId=e.userId,t.lPid=V.lp,e.sendWup2("liveui","getBadgeItem",t,function(e){n(e)})}:function(e){B.one("BadgeItemRsp",function(e){n(e.param)}),e.callAs("getBadgeItem",{})})}function l(e,n){B.ready(B.isH5?function(t){var a=new HUYA.SendOnTVBarrageReq,i=new HUYA.OnTVBarrage;i.lUid=e.userUid,i.sContent=e.msg,i.iTVType=e.tvType,i.iTVColor=e.tvColor,a.tUserId=t.userId,a.lPid=V.lp,a.lTid=P.id,a.lSid=P.sid,a.lOnTVId=e.gameId,a.tBarrage=i,a.lPrice=e.price,t.sendWup2("revenueui","sendOnTVBarrage",a,function(e){n&&n(e)})}:function(t){B.one("SendOnTVBarrageRsp",function(e){n&&n(e.param)}),t.callAs("sendOnTVBarrage",{lOnTVId:e.gameId,tBarrage:{lUid:e.userUid,sContent:e.msg,iTVType:e.tvType,iTVColor:e.tvColor},lPrice:e.price})})}function g(){function e(e,n){B.ready(function(t){"function"!=typeof n&&(n=function(){}),t.addTafListener(e,function(t){TT.log(e,t),n(t)})})}var n=["6294","6295","6296","6297","6232"],t={uri_6294:function(e){N=e.iState,3!=e.iState?o(e):(u(e),S.sentAmount=0)},uri_6295:function(e){N=e.iState,3!=e.iState?o(e):(u(e),S.sentAmount=0)},uri_6296:function(e){e.lOnTVId==w.gameId&&(w.receivedAmount=e.iBarrageNum,A.emit("update:receiveAmount",e.iBarrageNum))},uri_6297:function(){},uri_6232:function(e){!C.badge||0==e.iBadgeLevelChanged||e.tBadgeInfo.sBadgeName!=C.badge.name&&e.tBadgeInfo.tFaithInfo.sFaithName!=C.badge.name||(S.fansLevel=e.tBadgeInfo.iBadgeLevel,A.emit("update:badge"))}};if(B.isH5)for(var a=0;a<n.length;a++)e(n[a],t["uri_"+n[a]]);else B.on("onTVPanelChange",function(e){t.uri_6295(e.param)},!0),B.on("onTVDdataChange",function(e){t.uri_6296(e.param)},!0),B.on("onTVDEndNotice",function(e){t.uri_6297(e.param)},!0),B.on("BadgeScoreChangedNotice",function(e){t.uri_6232(e.param)},!0)}function p(e){f(function(n){var t=C.defaultGift.name;C={badge:function(){return n.lBadgeId>0?{id:n.lBadgeId,type:n.iBadgeType,name:1==n.iBadgeType?n.tFaithItem.sFaithName:n.sBadgeName}:!1}(),defaultGift:{type:n.iItemType,amount:n.iItemCount,name:t}},e&&e()})}function m(){s(function(e){S.sentAmount=e.iBarrageNum,A.emit("update:badge"),A.emit("update:sentAmount")})}function I(e){TT.getUserInfo(function(n){var t={gameId:w.gameId,userUid:n.uid,msg:S.msg,tvType:S.tvType,tvColor:S.tvColor,price:S.price};l(t,e)})}function v(){g(),p(function(){m(),F.ready(function(e){var n=e.getItem(C.badge.id,C.badge.type);n&&(S.fansLevel=n.iBadgeLevel,i())})}),c(function(e){N=e.iState,0!=e.iState&&(3!=e.iState?o(e):u(e))}),v=function(){}}function T(e){v(),e&&e()}var y=e("Event"),B=e("TTP"),P=e("TTR"),V=e("TTA"),F=e("widget/fansbadge"),A=new y,N=0,U=[],D=["#4B4B4B","#9FDE33","#33DE65","#50DBDB","#1ABBFF","#FF76B6","#FF5151","#FF8300","#FFDE00"],h=function(){var e=window.sessionStorage.getItem("propsDict");return e?JSON.parse(e):null}(),C={badge:!1,defaultGift:{type:"",name:"",amount:0}},w={mode:0,gameId:!1,isDiy:!1},L={tv:[{forFree:1,type:"\u9ed1\u767d",price:0,amount:1},{forFree:4,type:"\u5f69\u7535",price:0,amount:5},{forFree:10,type:"\u5927\u5f69\u7535",price:0,amount:3}],pack:[]},O={result:[]},S={sentAmount:0,fansLevel:0,tvType:0,tvColor:0,price:0,priceFormat:a(0),msg:"",giftTVChoice:0},b={state:function(){return N},tvColorList:function(){return $.extend({},D)},anchorInfo:function(){return $.extend({},C)},tvData:function(){return $.extend({},L)},lotteryInfo:function(){return $.extend({},w)},resultData:function(){return $.extend({},O)},playerInfo:function(){return $.extend({},S)}},k={playerInfo:function(e){S=$.extend({},!0,S,e)}};!function(){function e(e){A.emit("notice:message",{uid:e.lUid,nick:e.sNickName,nobleLevel:e.iNobleLevel,badge:{level:e.iBadgeLevel,name:e.sBadgeName,id:e.lBadgeId,type:e.iBadgeType},msg:e.tBarrage.sContent,color:D[e.tBarrage.iTVColor],msgIcon:e.sDiyIcon?e.sDiyIcon.replace("<size>","26_26").replace("<ua>","web"):!1})}B.isH5?B.ready(function(n){n.addTafListener("6298",function(n){TT.log("6298",n),e(n)})}):B.on("onTVBarrageNotice",function(n){e(n.param)},!0)}(),A=$.extend(A,{init:T,get:b,set:k,setPlayerPrice:i,getBadgeItem:p,getUserInfo:m,sendMsg:I,setGift:r}),t.exports=A});